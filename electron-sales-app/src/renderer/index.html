<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Manager</title>
    <link rel="stylesheet" href="styles.css">
    <script src="../../node_modules/chart.js/dist/chart.umd.js"></script>
    <script>
        // Theme Toggle Functionality
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        function updateThemeIcon(theme) {
            const sunIcon = document.getElementById('sunIcon');
            const moonIcon = document.getElementById('moonIcon');
            if (theme === 'dark') {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        // Modern Toast Notification System
        let toastContainer = null;

        function createToastContainer() {
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container';
                document.body.appendChild(toastContainer);
            }
            return toastContainer;
        }

        function showNotification(title, message, type = 'info', duration = 4000) {
            const container = createToastContainer();
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>',
                error: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>',
                warning: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',
                info: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || icons.info}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Auto remove
            if (duration > 0) {
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }
            
            return toast;
        }

        // Convenience methods
        window.showSuccess = (title, message, duration) => showNotification(title, message, 'success', duration);
        window.showError = (title, message, duration) => showNotification(title, message, 'error', duration);
        window.showWarning = (title, message, duration) => showNotification(title, message, 'warning', duration);
        window.showInfo = (title, message, duration) => showNotification(title, message, 'info', duration);

        // Check authentication on page load
        window.addEventListener('DOMContentLoaded', () => {
            // Initialize theme
            initTheme();

            // Add theme toggle event listener
            const themeToggleBtn = document.getElementById('themeToggleBtn');
            if (themeToggleBtn) {
                themeToggleBtn.addEventListener('click', toggleTheme);
            }

            const currentUser = sessionStorage.getItem('currentUser');
            if (!currentUser) {
                // Redirect to login if not authenticated
                window.location.href = 'login.html';
            } else {
                // Show user info in header
                const user = JSON.parse(currentUser);
                const userInfoDiv = document.createElement('div');
                userInfoDiv.className = 'user-info';
                userInfoDiv.innerHTML = `
                    <span class="user-name">${user.fullName}</span>
                    <span class="user-role" data-role="${user.role}">${user.role}</span>
                    <button id="logoutBtn" class="btn-icon" title="Logout">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16 17 21 12 16 7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                    </button>
                `;
                document.querySelector('.header-right').prepend(userInfoDiv);
                
                // Show Users button only for admins
                if (user.role === 'Admin') {
                    const usersHeaderBtn = document.getElementById('usersHeaderBtn');
                    if (usersHeaderBtn) {
                        usersHeaderBtn.style.display = 'block';
                    }
                }
                
                // Add logout functionality
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    sessionStorage.removeItem('currentUser');
                    window.location.href = 'login.html';
                });
            }
        });
    </script>
</head>
<body>
    <!-- Main Application -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <h1 class="app-title">
                    <svg width="40" height="40" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- Gradient Definitions -->
                        <defs>
                            <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#4f46e5;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="accentGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#06b6d4;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        
                        <!-- Main Circle Background -->
                        <circle cx="50" cy="50" r="45" fill="url(#logoGradient)" opacity="0.1"/>
                        
                        <!-- Letter D (stylized) -->
                        <path d="M 25 30 L 25 70 L 45 70 C 55 70 62 63 62 50 C 62 37 55 30 45 30 Z M 32 37 L 43 37 C 50 37 55 42 55 50 C 55 58 50 63 43 63 L 32 63 Z" 
                              fill="url(#logoGradient)" stroke="none"/>
                        
                        <!-- Rising Chart Bars (representing growth) -->
                        <rect x="68" y="55" width="6" height="15" rx="2" fill="url(#accentGradient)"/>
                        <rect x="76" y="45" width="6" height="25" rx="2" fill="url(#accentGradient)"/>
                        <rect x="84" y="35" width="6" height="35" rx="2" fill="url(#accentGradient)"/>
                        
                        <!-- Sparkle/Star accent -->
                        <circle cx="72" cy="28" r="2.5" fill="#fbbf24"/>
                        <path d="M 72 23 L 72 33 M 67 28 L 77 28" stroke="#fbbf24" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    <span>DALID Sales Manager</span>
                </h1>
                <span id="workbookPath" class="workbook-path" data-translate="common.noWorkbook">No workbook loaded</span>
            </div>
            <div class="header-right">
                <button id="themeToggleBtn" class="btn-icon" title="Toggle Dark/Light Mode">
                    <svg id="sunIcon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                    <svg id="moonIcon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
                <button id="usersHeaderBtn" class="btn-icon" data-translate-title="navigation.users" style="display: none;">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                </button>
                <button id="settingsHeaderBtn" class="btn-icon" data-translate-title="navigation.settings">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v6m0 6v6"/>
                        <path d="M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24"/>
                        <path d="M1 12h6m6 0h6"/>
                        <path d="M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/>
                    </svg>
                </button>
                <button id="refreshBtn" class="btn-icon" data-translate-title="common.refreshData">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 2v6h-6"/>
                        <path d="M3 12a9 9 0 0 1 15-6.7L21 8"/>
                        <path d="M3 22v-6h6"/>
                        <path d="M21 12a9 9 0 0 1-15 6.7L3 16"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3v18h18"/>
                    <path d="M18 17V9"/>
                    <path d="M13 17V5"/>
                    <path d="M8 17v-3"/>
                </svg>
                <span data-translate="navigation.dashboard">Dashboard</span>
            </button>
            <button class="nav-tab" data-tab="products">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                    <path d="M3.27 6.96L12 12.01l8.73-5.05M12 22.08V12"/>
                </svg>
                <span data-translate="navigation.products">Products</span>
            </button>
            <button class="nav-tab" data-tab="customers">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                <span data-translate="navigation.customers">Customers</span>
            </button>
            <button class="nav-tab" data-tab="sales">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="21" r="1"/>
                    <circle cx="20" cy="21" r="1"/>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                </svg>
                <span data-translate="navigation.sales">Sales & Invoices</span>
            </button>
            <button class="nav-tab" data-tab="inventory">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                    <path d="M12 22V12"/>
                    <path d="M3.27 6.96L12 12.01l8.73-5.05"/>
                </svg>
                <span data-translate="navigation.inventory">Inventory</span>
            </button>
            <button class="nav-tab" data-tab="analytics">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3v18h18"/>
                    <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                </svg>
                <span data-translate="navigation.analytics">Analytics</span>
            </button>
            <button class="nav-tab" data-tab="accounting" id="accountingNavBtn" style="display: none;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3h18v6H3z"/>
                    <path d="M3 13h18v8H3z"/>
                    <path d="M7 16h4"/>
                    <path d="M7 19h10"/>
                </svg>
                <span data-translate="navigation.accounting">Accounting</span>
            </button>
            <button class="nav-tab" data-tab="reports">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 20V10"/>
                    <path d="M12 20V4"/>
                    <path d="M6 20v-6"/>
                </svg>
                <span data-translate="navigation.reports">Reports</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="tab-content active">
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 data-translate="dashboard.totalSales">Total Sales</h3>
                            <p class="stat-value" id="totalSales">$0.00</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 3v18h18"/>
                                <path d="M18 17V9"/>
                                <path d="M13 17V5"/>
                                <path d="M8 17v-3"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 data-translate="dashboard.totalProfit">Total Profit</h3>
                            <p class="stat-value" id="totalProfit">$0.00</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                <path d="M3.27 6.96L12 12.01l8.73-5.05M12 22.08V12"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 data-translate="dashboard.totalProducts">Products</h3>
                            <p class="stat-value" id="totalProducts">0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 data-translate="dashboard.totalCustomers">Customers</h3>
                            <p class="stat-value" id="totalCustomers">0</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-section">
                    <h2 data-translate="dashboard.recentInvoices">Recent Invoices</h2>
                    <div id="recentInvoices" class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th data-translate="dashboard.invoiceId">Invoice ID</th>
                                    <th data-translate="common.date">Date</th>
                                    <th data-translate="common.customer">Customer</th>
                                    <th data-translate="common.amount">Amount</th>
                                    <th data-translate="dashboard.profit">Profit</th>
                                    <th data-translate="common.status">Status</th>
                                </tr>
                            </thead>
                            <tbody id="recentInvoicesBody">
                                <tr>
                                    <td colspan="6" class="empty-state" data-translate="common.noInvoices">No invoices yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="dashboard-section">
                    <h2 data-translate="dashboard.insights">Insights</h2>
                    <div class="dashboard-insights">
                        <div class="insight-card">
                            <h3 data-translate="dashboard.overview">Business Overview</h3>
                            <canvas id="dashboardOverviewChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="dashboard-section">
                    <h2 data-translate="dashboard.lowStockAlert">Low Stock Alert</h2>
                    <div id="lowStockAlert" class="alert-container">
                        <p class="empty-state" data-translate="common.allStocked">All products are well stocked</p>
                    </div>
                </div>
            </div>

            <!-- Accounting Tab -->
            <div id="accountingTab" class="tab-content">
                <div class="tab-header">
                    <h2 data-translate="accounting.title">Accounting</h2>
                </div>

                <div class="dashboard-grid" style="margin-bottom: 1.5rem;">
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3 data-translate="accounting.quickJournal">Quick Journal Entry</h3>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap; align-items: end;">
                                <div class="form-group" style="min-width: 160px;">
                                    <label data-translate="common.date">Date</label>
                                    <input type="date" id="jeDate" class="form-control">
                                </div>
                                <div class="form-group" style="flex: 1; min-width: 200px;">
                                    <label data-translate="common.description">Description</label>
                                    <input type="text" id="jeDesc" class="form-control" data-translate-placeholder="common.description" placeholder="Description">
                                </div>
                                <div class="form-group" style="min-width: 140px;">
                                    <label data-translate="accounting.reference">Reference</label>
                                    <input type="text" id="jeRef" class="form-control" data-translate-placeholder="accounting.reference" placeholder="Ref#">
                                </div>
                            </div>
                            <div style="margin-top: 10px;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th data-translate="accounting.line">Line</th>
                                            <th data-translate="accounting.account">Account</th>
                                            <th data-translate="accounting.debit">Debit</th>
                                            <th data-translate="accounting.credit">Credit</th>
                                            <th data-translate="common.actions">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="jeLinesBody">
                                        <tr>
                                            <td>1</td>
                                            <td><input class="form-control je-account" data-translate-placeholder="accounting.accountCodePlaceholder" placeholder="Account (code)" list="accountsDatalist"></td>
                                            <td><input type="number" class="form-control je-debit" min="0" step="0.01"></td>
                                            <td><input type="number" class="form-control je-credit" min="0" step="0.01"></td>
                                            <td><button class="btn btn-secondary btn-small btn-icon-only" id="jeAddLineBtn" title="Add Line">
                                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M12 5v14M5 12h14"/>
                                                </svg>
                                            </button></td>
                                        </tr>
                                    </tbody>
                                </table>
                                <!-- Accounts datalist for autocomplete -->
                                <datalist id="accountsDatalist"></datalist>
                                <div style="display:flex; gap: 10px; margin-top: 10px;">
                                    <button class="btn btn-primary" id="jeSubmitBtn" data-translate="accounting.postJournal">Post Journal</button>
                                    <span id="jeTotals" style="align-self: center; color: var(--text-secondary);"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-section">
                    <h2 data-translate="accounting.trialBalance">Trial Balance</h2>
                    <div style="display:flex; gap: 8px; margin-bottom: 10px; align-items: end; flex-wrap: wrap;">
                        <div class="form-group">
                            <label data-translate="reports.fromDate">From Date:</label>
                            <input type="date" id="tbFrom" class="form-control">
                        </div>
                        <div class="form-group">
                            <label data-translate="reports.toDate">To Date:</label>
                            <input type="date" id="tbTo" class="form-control">
                        </div>
                        <button class="btn btn-secondary" id="tbRefreshBtn" data-translate="common.refreshData">Refresh</button>
                        <button class="btn btn-secondary btn-icon-only" id="tbExportCsvBtn" title="Export CSV">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                                <circle cx="12" cy="5" r="2"/>
                            </svg>
                        </button>
                        <button class="btn btn-secondary btn-icon-only" id="tbExportPdfBtn" title="Export PDF">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th data-translate="accounting.code">Code</th>
                                    <th data-translate="accounting.account">Account</th>
                                    <th data-translate="accounting.type">Type</th>
                                    <th data-translate="accounting.debit">Debit</th>
                                    <th data-translate="accounting.credit">Credit</th>
                                    <th data-translate="accounting.balance">Balance</th>
                                </tr>
                            </thead>
                            <tbody id="tbBody">
                                <tr><td colspan="6" class="empty-state" data-translate="common.noData">No data</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="dashboard-section">
                    <h2 data-translate="accounting.financialStatements">Financial Statements</h2>
                    <div style="display:flex; gap: 8px; margin-bottom: 10px; align-items: end; flex-wrap: wrap;">
                        <div class="form-group">
                            <label data-translate="reports.fromDate">From Date:</label>
                            <input type="date" id="fsFrom" class="form-control">
                        </div>
                        <div class="form-group">
                            <label data-translate="accounting.toOrAsOf">To / As of</label>
                            <input type="date" id="fsTo" class="form-control">
                        </div>
                        <button class="btn btn-secondary" id="fsIncomeBtn" data-translate="accounting.incomeStatement">Income Statement</button>
                        <button class="btn btn-secondary" id="fsBalanceBtn" data-translate="accounting.balanceSheet">Balance Sheet</button>
                        <button class="btn btn-secondary btn-icon-only" id="fsExportCsvBtn" title="Export CSV">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                                <circle cx="12" cy="5" r="2"/>
                            </svg>
                        </button>
                        <button class="btn btn-secondary btn-icon-only" id="fsExportPdfBtn" title="Export PDF">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                        </button>
                    </div>
                    <div id="fsOutput" class="table-container"></div>
                </div>
            </div>

            <!-- Products Tab -->
            <div id="productsTab" class="tab-content">
                <div class="tab-header">
                    <h2 data-translate="products.management">Products Management</h2>
                    <div style="display: flex; gap: 0.75rem; align-items: center;">
                        <button id="showDeletedProductsBtn" class="btn btn-secondary" style="display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                            <span data-translate="products.viewDeleted">View Deleted</span>
                        </button>
                        <button id="showLowStockBtn" class="btn btn-secondary" style="display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <path d="M12 9v4M12 17h.01"/>
                            </svg>
                            <span data-translate="products.viewLowStock">View Low Stock</span>
                        </button>
                        <button id="addProductBtn" class="btn btn-primary btn-icon-only" title="Add Product">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="search-bar">
                    <input type="text" id="productSearch" data-translate-placeholder="products.searchPlaceholder" placeholder="Search products..." class="search-input">
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-translate="products.productName">Product Name</th>
                                <th data-translate="products.quantity">Quantity</th>
                                <th data-translate="products.buyPrice">Buy Price</th>
                                <th data-translate="products.salePrice">Sale Price</th>
                                <th data-translate="products.profitMargin">Profit Margin</th>
                                <th data-translate="common.actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <tr>
                                <td colspan="6" class="empty-state" data-translate="common.noProducts">No products found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Low Stock Products Modal -->
            <div id="lowStockModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 data-translate="products.lowStockTitle">Low Stock Products</h2>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-form">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th data-translate="common.product">Product</th>
                                        <th data-translate="common.quantity">Quantity</th>
                                    </tr>
                                </thead>
                                <tbody id="lowStockTableBody">
                                    <tr>
                                        <td colspan="2" class="empty-state" data-translate="common.allStocked">All products are well stocked</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="btn btn-secondary modal-cancel" data-translate="common.close">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Deleted Products Modal -->
            <div id="deletedProductsModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 data-translate="products.deletedProductsTitle">Deleted Products</h2>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-form">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th data-translate="products.productName">Product Name</th>
                                        <th data-translate="products.quantity">Quantity</th>
                                        <th data-translate="products.buyPrice">Buy Price</th>
                                        <th data-translate="products.salePrice">Sale Price</th>
                                        <th data-translate="common.actions">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="deletedProductsTableBody">
                                    <tr>
                                        <td colspan="5" class="empty-state" data-translate="products.noDeletedProducts">No deleted products</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="btn btn-secondary modal-cancel" data-translate="common.close">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Analysis Modal -->
            <div id="productAnalysisModal" class="modal">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h2 id="productAnalysisModalTitle" data-translate="products.productAnalysis">Product Analysis</h2>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-form">
                        <!-- Product Key Metrics -->
                        <div class="dashboard-grid" style="margin-bottom: 2rem;">
                            <div class="stat-card">
                                <div class="stat-icon" style="width: 60px; height: 60px; margin: 0 auto 1rem;">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                    </svg>
                                </div>
                                <div class="stat-info">
                                    <h3 data-translate="products.currentStock">Current Stock</h3>
                                    <p class="stat-value" id="productCurrentStock" style="font-size: 1.5rem;">0</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="width: 60px; height: 60px; margin: 0 auto 1rem;">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                    </svg>
                                </div>
                                <div class="stat-info">
                                    <h3 data-translate="products.totalRevenue">Total Revenue</h3>
                                    <p class="stat-value" id="productTotalRevenue" style="font-size: 1.5rem;">$0.00</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="width: 60px; height: 60px; margin: 0 auto 1rem;">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 3v18h18"/>
                                        <path d="M18 17V9"/>
                                        <path d="M13 17V5"/>
                                        <path d="M8 17v-3"/>
                                    </svg>
                                </div>
                                <div class="stat-info">
                                    <h3 data-translate="products.totalProfit">Total Profit</h3>
                                    <p class="stat-value" id="productTotalProfit" style="font-size: 1.5rem;">$0.00</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="width: 60px; height: 60px; margin: 0 auto 1rem;">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="9" cy="21" r="1"/>
                                        <circle cx="20" cy="21" r="1"/>
                                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                                    </svg>
                                </div>
                                <div class="stat-info">
                                    <h3 data-translate="products.unitsSold">Units Sold</h3>
                                    <p class="stat-value" id="productUnitsSold" style="font-size: 1.5rem;">0</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="width: 60px; height: 60px; margin: 0 auto 1rem;">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 3v18h18"/>
                                        <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                                    </svg>
                                </div>
                                <div class="stat-info">
                                    <h3 data-translate="products.profitMargin">Profit Margin</h3>
                                    <p class="stat-value" id="productProfitMargin" style="font-size: 1.5rem;">0%</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="width: 60px; height: 60px; margin: 0 auto 1rem;">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="1" x2="12" y2="23"/>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                    </svg>
                                </div>
                                <div class="stat-info">
                                    <h3 data-translate="products.avgSalePrice">Avg Sale Price</h3>
                                    <p class="stat-value" id="productAvgSalePrice" style="font-size: 1.5rem;">$0.00</p>
                                </div>
                            </div>
                        </div>

                        <!-- Sales Trend Chart -->
                        <div class="dashboard-section" style="margin-bottom: 2rem;">
                            <h2 data-translate="products.salesTrend">Sales Trend</h2>
                            <div style="height: 300px; position: relative;">
                                <canvas id="productSalesTrendChart"></canvas>
                            </div>
                        </div>

                        <!-- Inventory Movement History -->
                        <div class="dashboard-section">
                            <h2 data-translate="products.inventoryMovements">Inventory Movement History</h2>
                            <div class="table-container" style="max-height: 300px; overflow-y: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th data-translate="common.date">Date</th>
                                            <th data-translate="inventory.type">Type</th>
                                            <th data-translate="common.quantity">Quantity</th>
                                            <th data-translate="inventory.reference">Reference</th>
                                            <th data-translate="inventory.balanceAfter">Balance After</th>
                                            <th data-translate="inventory.notes">Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productInventoryMovementsBody">
                                        <tr>
                                            <td colspan="6" class="empty-state" data-translate="inventory.noMovements">No inventory movements</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="modal-actions">
                            <button type="button" class="btn btn-secondary modal-cancel" data-translate="common.close">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customers Tab -->
            <div id="customersTab" class="tab-content">
                <div class="tab-header">
                    <h2 data-translate="customers.title">Customers</h2>
                    <button id="addCustomerBtn" class="btn btn-primary btn-icon-only" title="Add Customer">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                    </button>
                </div>

                <div class="search-bar">
                    <input type="text" id="customerSearch" data-translate-placeholder="customers.searchPlaceholder" placeholder="Search customers..." class="search-input">
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-translate="customers.customerName">Customer Name</th>
                                <th data-translate="customers.phone">Phone</th>
                                <th data-translate="customers.email">Email</th>
                                <th data-translate="customers.address">Address</th>
                                <th data-translate="common.actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customersTableBody">
                            <tr>
                                <td colspan="5" class="empty-state" data-translate="common.noCustomers">No customers found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sales & Invoices Tab -->
            <div id="salesTab" class="tab-content">
                <div class="tab-header">
                    <h2 data-translate="sales.title">Sales & Invoices</h2>
                    <button id="newInvoiceBtn" class="btn btn-primary btn-icon-only" title="New Invoice">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                    </button>
                </div>

                <!-- Invoice Filters -->
                <div class="invoice-filters">
                    <div class="filter-group">
                        <label for="invoiceStatusFilter" data-translate="common.status">Status:</label>
                        <select id="invoiceStatusFilter" class="form-control">
                            <option value="all" data-translate="sales.allStatuses">All Statuses</option>
                            <option value="Paid" data-translate="sales.paid">Paid</option>
                            <option value="Pending" data-translate="sales.pending">Pending</option>
                            <option value="Cancelled" data-translate="sales.cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="invoiceCustomerFilter" data-translate="common.customer">Customer:</label>
                        <select id="invoiceCustomerFilter" class="form-control">
                            <option value="all" data-translate="sales.allCustomers">All Customers</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="invoiceDateFilter" data-translate="common.date">Date:</label>
                        <input type="date" id="invoiceDateFilter" class="form-control" data-translate-placeholder="sales.selectDate">
                    </div>
                    <button id="clearInvoiceFilters" class="btn btn-secondary btn-small btn-icon-only" title="Clear Filters">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 3H2l7 8v7l6-3v-4z"/>
                            <line x1="8" y1="8" x2="16" y2="16"/>
                            <line x1="16" y1="8" x2="8" y2="16"/>
                        </svg>
                    </button>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-translate="sales.invoiceId">Invoice ID</th>
                                <th data-translate="sales.date">Date</th>
                                <th data-translate="sales.customer">Customer</th>
                                <th data-translate="sales.totalAmount">Total Amount</th>
                                <th data-translate="sales.totalProfit">Total Profit</th>
                                <th data-translate="sales.status">Status</th>
                                <th data-translate="common.actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="invoicesTableBody">
                            <tr>
                                <td colspan="7" class="empty-state" data-translate="common.noInvoices">No invoices found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div id="inventoryTab" class="tab-content">
                <div class="tab-header">
                    <h2 data-translate="inventory.management">Inventory Management</h2>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <button id="addStockBtn" class="btn btn-primary btn-icon-only" title="Stock Movement">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                        <button id="exportInventoryPdfBtn" class="btn btn-primary btn-icon-only" title="Export to PDF">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Inventory Summary Cards -->
                <div class="dashboard-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="8.5" cy="7" r="4"/>
                                <path d="M20 8v6M23 11h-6"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 data-translate="inventory.totalStockItems">Total Items In Stock</h3>
                            <p class="stat-value" id="totalStockItems">0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 data-translate="inventory.totalStockValue">Total Stock Value</h3>
                            <p class="stat-value" id="totalStockValue">$0.00</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <path d="M12 9v4M12 17h.01"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 data-translate="inventory.lowStockItems">Low Stock Items</h3>
                            <p class="stat-value" id="lowStockCount">0</p>
                        </div>
                    </div>
                </div>

                <!-- Stock Movements Table -->
                <div class="dashboard-section">
                    <h2 data-translate="inventory.recentMovements">Recent Stock Movements</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th data-translate="common.date">Date</th>
                                    <th data-translate="common.product">Product</th>
                                    <th data-translate="inventory.type">Type</th>
                                    <th data-translate="common.quantity">Quantity</th>
                                    <th data-translate="inventory.reference">Reference</th>
                                    <th data-translate="inventory.balanceAfter">Balance After</th>
                                    <th data-translate="inventory.notes">Notes</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                <tr>
                                    <td colspan="7" class="empty-state" data-translate="inventory.noMovements">No inventory movements yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analyticsTab" class="tab-content">
                <div class="tab-header">
                    <h2 data-translate="analytics.title">Analytics & Statistics</h2>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <div class="analytics-period">
                            <select id="analyticsPeriod" class="form-control">
                                <option value="7" data-translate="analytics.last7Days">Last 7 Days</option>
                                <option value="30" selected data-translate="analytics.last30Days">Last 30 Days</option>
                                <option value="90" data-translate="analytics.last90Days">Last 90 Days</option>
                                <option value="365" data-translate="analytics.lastYear">Last Year</option>
                                <option value="all" data-translate="analytics.allTime">All Time</option>
                            </select>
                        </div>
                        <button id="exportAnalyticsPdfBtn" class="btn btn-primary btn-icon-only" title="Export to PDF">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Key Metrics Grid -->
                <div class="analytics-metrics">
                    <div class="metric-card metric-card-highlight">
                        <div class="metric-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                        </div>
                        <div class="metric-info">
                            <h4 data-translate="analytics.todayProfit">Today's Profit</h4>
                            <p class="metric-value" id="todayProfitValue">$0.00</p>
                            <span class="metric-change positive" id="todayProfitChange" data-translate="analytics.today">Today</span>
                        </div>
                    </div>
                    <div class="metric-card metric-card-highlight">
                        <div class="metric-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l-4 2"/>
                            </svg>
                        </div>
                        <div class="metric-info">
                            <h4 data-translate="analytics.yesterdayProfit">Yesterday's Profit</h4>
                            <p class="metric-value" id="yesterdayProfitValue">$0.00</p>
                            <span class="metric-change" id="yesterdayProfitChange" data-translate="analytics.yesterday">Yesterday</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="metric-info">
                            <h4 data-translate="analytics.avgOrderValue">Average Order Value</h4>
                            <p class="metric-value" id="avgOrderValue">$0.00</p>
                            <span class="metric-change positive" id="avgOrderChange">+0%</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="8.5" cy="7" r="4"/>
                                <path d="M20 8v6M23 11h-6"/>
                            </svg>
                        </div>
                        <div class="metric-info">
                            <h4 data-translate="analytics.totalCustomersMetric">Total Customers</h4>
                            <p class="metric-value" id="totalCustomersMetric">0</p>
                            <span class="metric-change positive" id="customersChange">+0</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                            </svg>
                        </div>
                        <div class="metric-info">
                            <h4 data-translate="analytics.productsSold">Products Sold</h4>
                            <p class="metric-value" id="totalProductsSold">0</p>
                            <span class="metric-change" id="productsSoldChange">0 <span data-translate="analytics.units">units</span></span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 3v18h18"/>
                                <path d="M18 17V9l-5 5-5-5-3 3"/>
                            </svg>
                        </div>
                        <div class="metric-info">
                            <h4 data-translate="analytics.profitMarginMetric">Profit Margin</h4>
                            <p class="metric-value" id="profitMarginMetric">0%</p>
                            <span class="metric-change positive" id="profitMarginChange">+0%</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="charts-grid">
                    <!-- Sales Trend Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 data-translate="analytics.salesTrend">Sales Trend</h3>
                            <p class="chart-subtitle" data-translate="analytics.revenueOverTime">Revenue over time</p>
                        </div>
                        <canvas id="salesTrendChart"></canvas>
                    </div>

                    <!-- Profit Trend Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 data-translate="analytics.profitTrend">Profit Trend</h3>
                            <p class="chart-subtitle" data-translate="analytics.profitOverTime">Profit over time</p>
                        </div>
                        <canvas id="profitTrendChart"></canvas>
                    </div>

                    <!-- Top Products Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 data-translate="analytics.topProducts">Top Products</h3>
                            <p class="chart-subtitle" data-translate="analytics.bestSelling">Best selling products</p>
                        </div>
                        <canvas id="topProductsChart"></canvas>
                    </div>

                    <!-- Product Categories Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 data-translate="analytics.salesByProduct">Sales by Product</h3>
                            <p class="chart-subtitle" data-translate="analytics.revenueDistribution">Revenue distribution</p>
                        </div>
                        <canvas id="productCategoriesChart"></canvas>
                    </div>

                    <!-- Customer Activity Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 data-translate="analytics.topCustomers">Top Customers</h3>
                            <p class="chart-subtitle" data-translate="analytics.topPurchases">By total purchases</p>
                        </div>
                        <canvas id="topCustomersChart"></canvas>
                    </div>

                    <!-- Inventory Status Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 data-translate="analytics.inventoryStatus">Inventory Status</h3>
                            <p class="chart-subtitle" data-translate="analytics.stockLevels">Stock levels</p>
                        </div>
                        <canvas id="inventoryStatusChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reportsTab" class="tab-content">
                <div class="tab-header">
                    <h2 data-translate="reports.title">Reports & Analytics</h2>
                    <button id="exportReportBtn" class="btn btn-secondary btn-icon-only" title="Export Report">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                        </svg>
                    </button>
                </div>

                <div class="report-filters">
                    <div class="form-group">
                        <label data-translate="reports.fromDate">From Date:</label>
                        <input type="date" id="reportFromDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label data-translate="reports.toDate">To Date:</label>
                        <input type="date" id="reportToDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label style="visibility: hidden;">Filter</label>
                        <button id="filterReportBtn" class="btn btn-primary btn-icon-only" title="Apply Filter">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 3H2l7 8v7l6-3v-4z"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="report-summary">
                    <div class="summary-card">
                        <h3 data-translate="reports.totalSales">Total Sales</h3>
                        <p class="summary-value" id="reportTotalSales">$0.00</p>
                    </div>
                    <div class="summary-card">
                        <h3 data-translate="reports.totalProfit">Total Profit</h3>
                        <p class="summary-value" id="reportTotalProfit">$0.00</p>
                    </div>
                    <div class="summary-card">
                        <h3 data-translate="reports.invoiceCount">Invoices Count</h3>
                        <p class="summary-value" id="reportInvoiceCount">0</p>
                    </div>
                </div>

                <div class="report-section">
                    <h3 data-translate="reports.salesByProduct">Sales by Product</h3>
                    <div id="salesByProduct" class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th data-translate="common.product">Product</th>
                                    <th data-translate="reports.quantitySold">Quantity Sold</th>
                                    <th data-translate="reports.totalSales">Total Sales</th>
                                    <th data-translate="reports.totalProfit">Total Profit</th>
                                </tr>
                            </thead>
                            <tbody id="salesByProductBody">
                                <tr>
                                    <td colspan="4" class="empty-state" data-translate="common.noData">No data available</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Users Tab (Admin Only) -->
            <div id="usersTab" class="tab-content">
                <div class="tab-header">
                    <h2 data-translate="users.title">User Management</h2>
                    <button id="addUserBtn" class="btn btn-primary btn-icon-only" title="Add User">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="8.5" cy="7" r="4"/>
                            <line x1="20" y1="8" x2="20" y2="14"/>
                            <line x1="23" y1="11" x2="17" y2="11"/>
                        </svg>
                    </button>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-translate="users.username">Username</th>
                                <th data-translate="users.fullName">Full Name</th>
                                <th data-translate="users.role">Role</th>
                                <th data-translate="users.email">Email</th>
                                <th data-translate="users.createdDate">Created Date</th>
                                <th data-translate="users.status">Status</th>
                                <th data-translate="common.actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr>
                                <td colspan="7" class="empty-state" data-translate="users.loadingUsers">Loading users...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content">
                <div class="tab-header">
                    <h2 data-translate="settings.title">Settings</h2>
                </div>

                <div class="settings-container">
                    <!-- Language Settings -->
                    <div class="settings-section">
                        <h3 data-translate="settings.languageRegion">Language & Region</h3>
                        <div class="settings-group">
                            <label for="languageSelect" data-translate="settings.language">Language</label>
                            <select id="languageSelect" class="form-control">
                                <option value="en" data-translate="settings.english">English</option>
                                <option value="fr" data-translate="settings.french">Français</option>
                                <option value="ar" data-translate="settings.arabic">العربية</option>
                            </select>
                            <p class="form-hint" data-translate="settings.languageHint">Choose your preferred language for the application interface.</p>
                        </div>
                        <div class="settings-group">
                            <label for="currencySelect" data-translate="settings.currency">Currency</label>
                            <select id="currencySelect" class="form-control">
                                <option value="USD">USD ($)</option>
                                <option value="EUR">EUR (€)</option>
                                <option value="GBP">GBP (£)</option>
                                <option value="JPY">JPY (¥)</option>
                                <option value="CNY">CNY (¥)</option>
                                <option value="DZD">DZD (د.ج)</option>
                                <option value="SAR">SAR (ر.س)</option>
                                <option value="AED">AED (د.إ)</option>
                                <option value="MAD">MAD (د.م.)</option>
                            </select>
                            <p class="form-hint" data-translate="settings.currencyHint">Choose the currency to display throughout the application.</p>
                        </div>
                    </div>

                    <!-- Display Settings -->
                    <div class="settings-section">
                        <h3 data-translate="settings.display">Display</h3>
                        <div class="settings-group">
                            <label for="themeSelect" data-translate="settings.theme">Theme</label>
                            <select id="themeSelect" class="form-control">
                                <option value="light" data-translate="settings.light">Light</option>
                                <option value="dark" data-translate="settings.dark">Dark</option>
                                <option value="auto" data-translate="settings.auto">Auto (System)</option>
                            </select>
                            <p class="form-hint" data-translate="settings.themeHint">Choose your preferred theme for the application.</p>
                        </div>
                        <div class="settings-group">
                            <label for="fontSizeSelect" data-translate="settings.fontSize">Font Size</label>
                            <select id="fontSizeSelect" class="form-control">
                                <option value="small" data-translate="settings.small">Small</option>
                                <option value="medium" data-translate="settings.medium">Medium</option>
                                <option value="large" data-translate="settings.large">Large</option>
                            </select>
                            <p class="form-hint" data-translate="settings.fontSizeHint">Adjust the text size for better readability.</p>
                        </div>
                    </div>

                    <!-- Data Settings -->
                    <div class="settings-section">
                        <h3 data-translate="settings.dataManagement">Data Management</h3>
                        <div class="settings-group">
                            <label for="autoBackupToggle" data-translate="settings.autoBackup">Auto Backup</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="autoBackupToggle" checked>
                                <span class="toggle-slider"></span>
                            </div>
                            <p class="form-hint" data-translate="settings.autoBackupHint">Automatically create backup copies when saving data.</p>
                        </div>
                        <div class="settings-group">
                            <label for="backupRetentionSelect" data-translate="settings.backupRetention">Backup Retention</label>
                            <select id="backupRetentionSelect" class="form-control">
                                <option value="3" data-translate="settings.threeBackups">3 backups</option>
                                <option value="5" selected data-translate="settings.fiveBackups">5 backups</option>
                                <option value="10" data-translate="settings.tenBackups">10 backups</option>
                                <option value="unlimited" data-translate="settings.unlimited">Unlimited</option>
                            </select>
                            <p class="form-hint" data-translate="settings.backupRetentionHint">Number of backup files to keep.</p>
                        </div>
                        
                        <!-- Backup Manager -->
                        <div class="settings-group">
                            <label data-translate="settings.backupManager">Backup Manager</label>
                            <p class="form-hint" data-translate="settings.backupManagerHint">View, restore, or delete backup files.</p>
                            <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                                <button id="viewBackupsBtn" class="btn btn-primary">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                        <polyline points="10 9 9 9 8 9"/>
                                    </svg>
                                    <span data-translate="settings.viewBackups">View Backups</span>
                                </button>
                                <button id="createBackupBtn" class="btn btn-secondary">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                        <polyline points="17,21 17,13 7,13 7,21"/>
                                        <polyline points="7,3 7,8 15,8"/>
                                    </svg>
                                    <span data-translate="settings.createBackup">Create Backup Now</span>
                                </button>
                                <button id="fileMenuBtn" class="btn btn-secondary">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7 10 12 15 17 10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                    <span data-translate="settings.saveCopy">Save a Copy</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Notification Settings -->
                    <div class="settings-section">
                        <h3 data-translate="settings.notifications">Notifications</h3>
                        <div class="settings-group">
                            <label for="lowStockNotificationsToggle" data-translate="settings.lowStockAlerts">Low Stock Alerts</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="lowStockNotificationsToggle" checked>
                                <span class="toggle-slider"></span>
                            </div>
                            <p class="form-hint" data-translate="settings.lowStockHint">Receive notifications when products are running low on stock.</p>
                        </div>
                        <div class="settings-group">
                            <label for="lowStockThreshold" data-translate="settings.lowStockThreshold">Low stock threshold</label>
                            <input type="number" id="lowStockThreshold" class="form-control" min="0" step="1" value="5">
                            <p class="form-hint" data-translate="settings.lowStockThresholdHint">Products at or below this quantity will be highlighted and shown in alerts.</p>
                        </div>
                        <div class="settings-group">
                            <label for="soundNotificationsToggle" data-translate="settings.soundNotifications">Sound Notifications</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="soundNotificationsToggle" checked>
                                <span class="toggle-slider"></span>
                            </div>
                            <p class="form-hint" data-translate="settings.soundHint">Play sound effects for notifications.</p>
                        </div>
                    </div>

                    <!-- Application Settings -->
                    <div class="settings-section">
                        <h3 data-translate="settings.application">Application</h3>
                        <div class="settings-group">
                            <label for="startupBehaviorSelect" data-translate="settings.startupBehavior">Startup Behavior</label>
                            <select id="startupBehaviorSelect" class="form-control">
                                <option value="lastWorkbook" data-translate="settings.lastWorkbook">Open last used workbook</option>
                                <option value="defaultWorkbook" data-translate="settings.defaultWorkbook">Open default workbook</option>
                                <option value="prompt" data-translate="settings.prompt">Ask which workbook to open</option>
                            </select>
                            <p class="form-hint" data-translate="settings.startupHint">Choose what happens when the application starts.</p>
                        </div>
                        <div class="settings-group">
                            <label for="autoRefreshToggle" data-translate="settings.autoRefresh">Auto Refresh Data</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="autoRefreshToggle">
                                <span class="toggle-slider"></span>
                            </div>
                            <p class="form-hint" data-translate="settings.autoRefreshHint">Automatically refresh data every 5 minutes.</p>
                        </div>
                        <div class="settings-group">
                            <label for="accountingEnabledToggle" data-translate="settings.enableAccounting">Enable Accounting</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="accountingEnabledToggle">
                                <span class="toggle-slider"></span>
                            </div>
                            <p class="form-hint" data-translate="settings.enableAccountingHint">Show or hide the Accounting module and tab.</p>
                        </div>
                        <div class="settings-group">
                            <label data-translate="settings.workbookSource">Workbook Source</label>
                            <div class="input-with-button" style="display: flex; gap: 10px; align-items: center;">
                                <input id="customWorkbookPathInput" type="text" class="form-control" placeholder="/path/to/file.xlsx" readonly style="flex: 1; min-width: 0;">
                                <button id="selectWorkbookBtn" class="btn btn-secondary" type="button" style="white-space: nowrap;">
                                    <span data-translate="settings.selectWorkbook">Select Excel file</span>
                                </button>
                                <button id="clearWorkbookBtn" class="btn btn-tertiary" type="button" style="white-space: nowrap;">
                                    <span data-translate="settings.useDefaultFile">Use default</span>
                                </button>
                            </div>
                            <p class="form-hint" data-translate="settings.workbookSourceHint">Choose a specific Excel file to override the default.</p>
                        </div>
                    </div>

                    <!-- GDPR & Data Privacy -->
                    <div class="settings-section">
                        <h3 data-translate="gdpr.title">GDPR & Data Privacy</h3>
                        <p class="section-subtitle" data-translate="gdpr.subtitle">Manage customer data privacy and compliance</p>
                        
                        <!-- Export Customer Data -->
                        <div class="settings-group">
                            <label data-translate="gdpr.exportData">Export Customer Data</label>
                            <p class="form-hint" data-translate="gdpr.exportDataDesc">Export all personal data for a customer (GDPR Right to Access)</p>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <select id="gdprExportCustomerSelect" class="form-control" style="flex: 1;">
                                    <option value="" data-translate="gdpr.selectCustomerPlaceholder">Choose a customer...</option>
                                </select>
                                <button id="gdprExportBtn" class="btn btn-primary btn-icon-only" title="Export Data">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7 10 12 15 17 10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Delete Customer Data -->
                        <div class="settings-group">
                            <label data-translate="gdpr.deleteData">Delete Customer Data</label>
                            <p class="form-hint" data-translate="gdpr.deleteDataDesc">Permanently delete or anonymize customer data (Right to be Forgotten)</p>
                            <div style="display: flex; gap: 10px; margin-top: 10px; flex-direction: column;">
                                <select id="gdprDeleteCustomerSelect" class="form-control">
                                    <option value="" data-translate="gdpr.selectCustomerPlaceholder">Choose a customer...</option>
                                </select>
                                <input type="text" id="gdprDeleteReason" class="form-control" placeholder="Enter reason for deletion (required)" data-translate-placeholder="gdpr.deleteReasonPlaceholder">
                                <button id="gdprDeleteBtn" class="btn btn-danger">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                    <span data-translate="gdpr.deleteButton">Delete Data</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Audit & Compliance -->
                    <div class="settings-section">
                        <h3 data-translate="audit.title">Audit & Compliance</h3>
                        <p class="section-subtitle" data-translate="audit.subtitle">View activity logs and generate audit reports</p>
                        
                        <!-- View Activity Logs -->
                        <div class="settings-group">
                            <label data-translate="audit.activityLogs">Activity Logs</label>
                            <p class="form-hint" data-translate="audit.activityLogsDesc">View all user actions and system changes</p>
                            <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                                <input type="date" id="auditStartDate" class="form-control" style="flex: 1; min-width: 150px;">
                                <input type="date" id="auditEndDate" class="form-control" style="flex: 1; min-width: 150px;">
                                <button id="auditViewLogsBtn" class="btn btn-primary">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                        <circle cx="12" cy="12" r="3"/>
                                    </svg>
                                    <span data-translate="audit.viewLogs">View Logs</span>
                                </button>
                            </div>
                            <div id="auditLogsContainer" style="margin-top: 15px; max-height: 300px; overflow-y: auto; display: none;">
                                <table class="data-table" style="font-size: 12px;">
                                    <thead>
                                        <tr>
                                            <th data-translate="audit.timestamp">Timestamp</th>
                                            <th data-translate="audit.userName">User</th>
                                            <th data-translate="audit.action">Action</th>
                                            <th data-translate="audit.entity">Entity</th>
                                        </tr>
                                    </thead>
                                    <tbody id="auditLogsTableBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Generate Audit Report -->
                        <div class="settings-group">
                            <label data-translate="audit.generateReport">Generate Audit Report</label>
                            <p class="form-hint" data-translate="audit.generateReportDesc">Create comprehensive audit report for compliance</p>
                            <button id="auditGenerateReportBtn" class="btn btn-primary">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                    <polyline points="10 9 9 9 8 9"/>
                                </svg>
                                <span data-translate="audit.generateBtn">Generate Report</span>
                            </button>
                        </div>

                        <!-- Export Audit Logs -->
                        <div class="settings-group">
                            <label data-translate="audit.exportLogs">Export Audit Logs</label>
                            <p class="form-hint" data-translate="audit.exportLogsDesc">Export logs in JSON or CSV format</p>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button id="auditExportJSONBtn" class="btn btn-secondary btn-icon-only" title="Export as JSON">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                        <polyline points="10 9 9 9 8 9"/>
                                    </svg>
                                </button>
                                <button id="auditExportCSVBtn" class="btn btn-secondary btn-icon-only" title="Export as CSV">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7 10 12 15 17 10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="settings-actions">
                        <button id="saveSettingsBtn" class="btn btn-primary">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                <polyline points="17,21 17,13 7,13 7,21"/>
                                <polyline points="7,3 7,8 15,8"/>
                            </svg>
                            <span data-translate="settings.saveSettings">Save Settings</span>
                        </button>
                        <button id="resetSettingsBtn" class="btn btn-secondary">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                                <path d="M21 3v5h-5"/>
                                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                                <path d="M3 21v-5h5"/>
                            </svg>
                            <span data-translate="settings.resetDefaults">Reset to Defaults</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="productModalTitle" data-translate="products.addProduct">Add Product</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="productForm" class="modal-form">
                <div class="form-group">
                    <label for="productName"><span data-translate="products.productName">Product Name</span> <span data-translate="products.required">*</span></label>
                    <input type="text" id="productName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="productQuantity"><span data-translate="products.quantity">Quantity</span> <span data-translate="products.required">*</span></label>
                    <input type="number" id="productQuantity" class="form-control" min="0" required>
                </div>
                <div class="form-group">
                    <label for="productBuyPrice"><span data-translate="products.buyPrice">Buy Price</span> <span data-translate="products.required">*</span></label>
                    <input type="number" id="productBuyPrice" class="form-control" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="productSalePrice"><span data-translate="products.salePrice">Sale Price</span> <span data-translate="products.required">*</span></label>
                    <input type="number" id="productSalePrice" class="form-control" min="0" step="0.01" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary modal-cancel" data-translate="common.cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-translate="common.save">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer Modal -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="customerModalTitle" data-translate="customers.addCustomer">Add Customer</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="customerForm" class="modal-form">
                <div class="form-group">
                    <label for="customerName"><span data-translate="customers.customerName">Customer Name</span> <span data-translate="customers.required">*</span></label>
                    <input type="text" id="customerName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="customerPhone" data-translate="customers.phone">Phone</label>
                    <input type="tel" id="customerPhone" class="form-control">
                </div>
                <div class="form-group">
                    <label for="customerEmail" data-translate="customers.email">Email</label>
                    <input type="email" id="customerEmail" class="form-control">
                </div>
                <div class="form-group">
                    <label for="customerAddress" data-translate="customers.address">Address</label>
                    <textarea id="customerAddress" class="form-control" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary modal-cancel" data-translate="common.cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-translate="common.save">Save</button>
                </div>
            </form>
            
            <!-- Purchase History Section (shown when editing) -->
            <div id="customerPurchaseHistory" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border-color);">
                <h3 style="margin-bottom: 15px; color: var(--text-primary);">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10 9 9 9 8 9"/>
                    </svg>
                    <span data-translate="customers.purchaseHistory">Purchase History</span>
                </h3>
                <div id="customerPurchaseHistoryContent">
                    <p class="empty-state" data-translate="customers.noPurchases">No purchases yet</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 data-translate="sales.newInvoice">New Invoice</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-form">
                <div class="invoice-header-form">
                    <div class="form-group">
                        <label for="invoiceCustomer"><span data-translate="sales.customer">Customer</span> <span data-translate="sales.required">*</span></label>
                        <div class="autocomplete-wrapper">
                            <input type="text" id="invoiceCustomer" class="form-control" data-translate-placeholder="sales.typeToSearch" required>
                            <div id="customerAutocomplete" class="autocomplete-dropdown"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="invoiceDate"><span data-translate="sales.date">Date</span> <span data-translate="sales.required">*</span></label>
                        <input type="date" id="invoiceDate" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="invoiceStatus" data-translate="sales.status">Status</label>
                        <select id="invoiceStatus" class="form-control">
                            <option value="Pending" data-translate="sales.pending">Pending</option>
                            <option value="Paid" data-translate="sales.paid">Paid</option>
                            <option value="Cancelled" data-translate="sales.cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>

                <h3 data-translate="sales.invoiceItems">Invoice Items</h3>
                <div class="invoice-items-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="itemProduct" data-translate="sales.product">Product</label>
                            <div class="autocomplete-wrapper">
                                <input type="text" id="itemProduct" class="form-control" data-translate-placeholder="sales.typeToSearch">
                                <div id="productAutocomplete" class="autocomplete-dropdown"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="itemQuantity" data-translate="sales.quantity">Quantity</label>
                            <input type="number" id="itemQuantity" class="form-control" min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="itemUnitPrice" data-translate="sales.unitPrice">Unit Price</label>
                            <input type="number" id="itemUnitPrice" class="form-control" min="0" step="0.01" readonly>
                        </div>
                        <div class="form-group">
                            <label for="itemTotal" data-translate="sales.total">Total</label>
                            <input type="number" id="itemTotal" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button type="button" id="addItemBtn" class="btn btn-primary btn-icon-only" title="Add Item">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 5v14M5 12h14"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="invoice-items-list">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-translate="sales.product">Product</th>
                                <th data-translate="common.quantity">Quantity</th>
                                <th data-translate="sales.unitPrice">Unit Price</th>
                                <th data-translate="sales.total">Total</th>
                                <th data-translate="sales.profit">Profit</th>
                                <th data-translate="common.actions">Action</th>
                            </tr>
                        </thead>
                        <tbody id="invoiceItemsBody">
                            <tr>
                                <td colspan="6" class="empty-state" data-translate="sales.noItems">No items added yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="invoice-summary">
                    <div class="summary-row">
                        <span data-translate="sales.totalAmount">Total Amount:</span>
                        <strong id="invoiceTotalAmount">$0.00</strong>
                    </div>
                    <div class="summary-row">
                        <span data-translate="sales.totalProfit">Total Profit:</span>
                        <strong id="invoiceTotalProfit">$0.00</strong>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary modal-cancel" data-translate="common.cancel">Cancel</button>
                    <button type="button" id="saveInvoiceBtn" class="btn btn-primary" data-translate="sales.saveInvoice">Save Invoice</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Invoice Status Modal -->
    <div id="editStatusModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 data-translate="sales.editStatus">Edit Invoice Status</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="editStatusForm" class="modal-form">
                <div class="form-group">
                    <label data-translate="sales.invoiceId">Invoice ID</label>
                    <input type="text" id="editStatusInvoiceId" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label data-translate="common.customer">Customer</label>
                    <input type="text" id="editStatusCustomer" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label for="editStatusSelect"><span data-translate="sales.status">Status</span> <span data-translate="sales.required">*</span></label>
                    <select id="editStatusSelect" class="form-control" required>
                        <option value="Paid" data-translate="sales.paid">Paid</option>
                        <option value="Pending" data-translate="sales.pending">Pending</option>
                        <option value="Cancelled" data-translate="sales.cancelled">Cancelled</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary modal-cancel" data-translate="common.cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-translate="sales.updateStatus">Update Status</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Inventory Movement Modal -->
    <div id="inventoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-translate="inventory.stockMovement">Stock Movement</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="inventoryForm" class="modal-form">
                <div class="form-group">
                    <label for="movementProduct"><span data-translate="common.product">Product</span> <span data-translate="inventory.required">*</span></label>
                    <select id="movementProduct" class="form-control" required>
                        <option value="" data-translate="inventory.selectProduct">Select Product</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="movementType"><span data-translate="inventory.movementType">Movement Type</span> <span data-translate="inventory.required">*</span></label>
                    <select id="movementType" class="form-control" required>
                        <option value="IN" data-translate="inventory.stockIn">Stock In (Purchase/Return)</option>
                        <option value="OUT" data-translate="inventory.stockOut">Stock Out (Sale/Damage)</option>
                        <option value="ADJUSTMENT" data-translate="inventory.adjustmentType">Adjustment (Inventory Count)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="movementQuantity"><span data-translate="common.quantity">Quantity</span> <span data-translate="inventory.required">*</span></label>
                    <input type="number" id="movementQuantity" class="form-control" min="1" required>
                    <small class="form-hint"><span data-translate="inventory.currentStock">Current stock:</span> <span id="currentStock">0</span></small>
                </div>
                <div class="form-group">
                    <label for="movementDate"><span data-translate="common.date">Date</span> <span data-translate="inventory.required">*</span></label>
                    <input type="date" id="movementDate" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="movementReference" data-translate="inventory.reference">Reference</label>
                    <input type="text" id="movementReference" class="form-control" placeholder="PO#, Invoice#, etc.">
                </div>
                <div class="form-group">
                    <label for="movementNotes" data-translate="inventory.notes">Notes</label>
                    <textarea id="movementNotes" class="form-control" rows="3" placeholder="Additional notes..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary modal-cancel" data-translate="common.cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-translate="inventory.saveMovement">Save Movement</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="userModalTitle" data-translate="users.addUser">Add User</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="userForm" class="modal-form">
                <div class="form-group">
                    <label for="userUsername"><span data-translate="users.username">Username</span> <span data-translate="users.required">*</span></label>
                    <input type="text" id="userUsername" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="userPassword"><span data-translate="users.password">Password</span> <span data-translate="users.required">*</span></label>
                    <input type="password" id="userPassword" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="userFullName"><span data-translate="users.fullName">Full Name</span> <span data-translate="users.required">*</span></label>
                    <input type="text" id="userFullName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="userRole"><span data-translate="users.role">Role</span> <span data-translate="users.required">*</span></label>
                    <select id="userRole" class="form-control" required>
                        <option value="Admin" data-translate="users.admin">Admin</option>
                        <option value="Manager" data-translate="users.manager">Manager</option>
                        <option value="Cashier" data-translate="users.cashier">Cashier</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="userEmail" data-translate="users.email">Email</label>
                    <input type="email" id="userEmail" class="form-control">
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="userIsActive" checked>
                        <span data-translate="users.activeUser">Active User</span>
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary modal-cancel" data-translate="common.cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-translate="users.saveUser">Save User</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer History Modal -->
    <div id="customerHistoryModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="customerHistoryTitle" data-translate="customers.customerHistory">Customer History</h2>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <button class="btn btn-secondary btn-icon-only" onclick="exportCustomerHistoryPDF()" title="Export PDF">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                    </button>
                    <button class="btn btn-primary btn-icon-only" onclick="exportCustomerHistoryExcel()" title="Export Excel">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="9" y1="15" x2="15" y2="15"/>
                        </svg>
                    </button>
                    <button class="modal-close">&times;</button>
                </div>
            </div>
            <div class="modal-form">
                <!-- Customer Analytics Summary -->
                <div class="dashboard-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-icon" style="width: 60px; height: 60px; margin: 0 auto 1rem;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 data-translate="customers.totalSpent">Total Spent</h3>
                            <p class="stat-value" id="customerTotalSpent" style="font-size: 1.5rem;">$0.00</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="width: 60px; height: 60px; margin: 0 auto 1rem;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 data-translate="customers.totalInvoices">Total Invoices</h3>
                            <p class="stat-value" id="customerTotalInvoices" style="font-size: 1.5rem;">0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="width: 60px; height: 60px; margin: 0 auto 1rem;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 data-translate="customers.lastPurchase">Last Purchase</h3>
                            <p class="stat-value" id="customerLastPurchase" style="font-size: 1rem;">-</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="width: 60px; height: 60px; margin: 0 auto 1rem;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"/>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 data-translate="customers.avgOrder">Average Order</h3>
                            <p class="stat-value" id="customerAvgOrder" style="font-size: 1.5rem;">$0.00</p>
                        </div>
                    </div>
                </div>

                <!-- Purchase Trend Chart -->
                <div class="dashboard-section" style="margin-bottom: 2rem;">
                    <h2 data-translate="customers.purchaseTrend">Purchase Trend</h2>
                    <div style="height: 250px; position: relative;">
                        <canvas id="customerPurchaseTrendChart"></canvas>
                    </div>
                </div>

                <!-- Customer Invoices -->
                <div class="dashboard-section">
                    <h2 data-translate="customers.invoiceHistory">Invoice History</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th data-translate="sales.invoiceId">Invoice ID</th>
                                    <th data-translate="common.date">Date</th>
                                    <th data-translate="common.amount">Amount</th>
                                    <th data-translate="dashboard.profit">Profit</th>
                                    <th data-translate="common.status">Status</th>
                                    <th data-translate="common.actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customerInvoicesTableBody">
                                <tr>
                                    <td colspan="6" class="empty-state" data-translate="common.noInvoices">No invoices found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Backup Manager Modal -->
    <div id="backupManagerModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 data-translate="settings.backupManager">Backup Manager</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-form">
                <div class="backup-manager-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <p class="form-hint" data-translate="settings.backupListDesc">View and manage your backup files. You can restore or delete backups as needed.</p>
                    <button id="refreshBackupsBtn" class="btn btn-secondary btn-icon-only" title="Refresh List">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                            <path d="M21 3v5h-5"/>
                            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                            <path d="M3 21v-5h5"/>
                        </svg>
                    </button>
                </div>
                
                <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-translate="settings.backupName">Backup Name</th>
                                <th data-translate="settings.backupDate">Date Created</th>
                                <th data-translate="settings.backupSize">Size</th>
                                <th data-translate="common.actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="backupsTableBody">
                            <tr>
                                <td colspan="4" class="empty-state" data-translate="settings.loadingBackups">Loading backups...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary modal-cancel" data-translate="common.close">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="../../dist/renderer/renderer.js"></script>
</body>
</html>
